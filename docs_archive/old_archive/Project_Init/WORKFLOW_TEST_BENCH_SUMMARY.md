# Workflow Test Bench (Testing for Agent Git v0.2) - Executive Summary

## 1. Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    ç”¨æˆ·å±‚                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚   Web UI    â”‚   â”‚     CLI     â”‚   â”‚  REST API   â”‚   â”‚  WebSocket  â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                 â”‚                 â”‚                 â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                      â”‚
â”‚                          Workflow Test Bench (WTB)                                   â”‚
â”‚                              â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                      â”‚
â”‚                                  æ ¸å¿ƒç¼–æ’å±‚                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                           TestOrchestrator                                      â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚ â”‚
â”‚  â”‚  â”‚ Execution    â”‚ â”‚    Node      â”‚ â”‚    Batch     â”‚ â”‚  Evaluation  â”‚           â”‚ â”‚
â”‚  â”‚  â”‚ Controller   â”‚ â”‚   Replacer   â”‚ â”‚  TestRunner  â”‚ â”‚    Engine    â”‚           â”‚ â”‚
â”‚  â”‚  â”‚              â”‚ â”‚              â”‚ â”‚              â”‚ â”‚              â”‚           â”‚ â”‚
â”‚  â”‚  â”‚ â€¢run/pause   â”‚ â”‚ â€¢hot-swap    â”‚ â”‚ â€¢parallel    â”‚ â”‚ â€¢metrics     â”‚           â”‚ â”‚
â”‚  â”‚  â”‚ â€¢resume/stop â”‚ â”‚ â€¢variants    â”‚ â”‚ â€¢compare     â”‚ â”‚ â€¢scoring     â”‚           â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚            â”‚                â”‚                â”‚                â”‚                      â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                      â”‚                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                        State Adapter Registry                                  â”‚  â”‚
â”‚  â”‚                     (ä¾èµ–æ³¨å…¥ - å¯æ’æ‹”é€‚é…å™¨)                                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                      â”‚                                               â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚         â”‚                            â”‚                            â”‚                 â”‚
â”‚         â–¼                            â–¼                            â–¼                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  InMemory  â”‚            â”‚   AgentGit       â”‚           â”‚  FileTracker   â”‚        â”‚
â”‚  â”‚  Adapter   â”‚            â”‚   Adapter        â”‚           â”‚  Adapter       â”‚        â”‚
â”‚  â”‚            â”‚            â”‚                  â”‚           â”‚                â”‚        â”‚
â”‚  â”‚ å¼€å‘/æµ‹è¯•   â”‚            â”‚ çŠ¶æ€+åˆ†æ”¯+å›æ»š    â”‚           â”‚ æ–‡ä»¶ç‰ˆæœ¬æ§åˆ¶    â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                     â”‚                             â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚                             â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                                                                     â”‚
              â–¼                                                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                  â”‚                       â”‚                              â”‚
â”‚      AgentGit v0.2.0 
        (change agent infra)       â”‚                       â”‚      FileTracker             â”‚
â”‚      â•â•â•â•â•â•â•â•â•â•â•â•â•â•              â”‚                       â”‚      â•â•â•â•â•â•â•â•â•â•              â”‚
â”‚                                  â”‚                       â”‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ CheckpointManager_mdp      â”‚  â”‚                       â”‚  â”‚ BlobRepository         â”‚  â”‚
â”‚  â”‚ â€¢ Node Checkpoint          â”‚  â”‚                       â”‚  â”‚ â€¢ å†…å®¹å¯»å€å­˜å‚¨          â”‚  â”‚
â”‚  â”‚ â€¢ Tool/Message Checkpoint  â”‚  â”‚                       â”‚  â”‚ â€¢ SHA-256 å»é‡         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ InternalSession_mdp        â”‚  â”‚                       â”‚  â”‚ CommitRepository       â”‚  â”‚
â”‚  â”‚ â€¢ workflow_variables       â”‚  â”‚                       â”‚  â”‚ â€¢ ç‰ˆæœ¬å†å²             â”‚  â”‚
â”‚  â”‚ â€¢ execution_path           â”‚  â”‚                       â”‚  â”‚ â€¢ æ—¶é—´çº¿               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ToolManager                â”‚  â”‚                       â”‚  â”‚ FileMementoRepository  â”‚  â”‚
â”‚  â”‚ â€¢ å·¥å…·è°ƒç”¨è¿½è¸ª              â”‚  â”‚                       â”‚  â”‚ â€¢ æ–‡ä»¶å¿«ç…§             â”‚  â”‚
â”‚  â”‚ â€¢ å‰¯ä½œç”¨å›æ»š               â”‚  â”‚                       â”‚  â”‚ â€¢ è·¯å¾„æ˜ å°„             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                  â”‚                       â”‚                              â”‚
â”‚  DB: checkpoints,            â”‚                       â”‚  PostgreSQL + æ–‡ä»¶ç³»ç»Ÿ:       â”‚
â”‚          internal_sessions       â”‚                       â”‚  file_blobs, commits,        â”‚
â”‚                                  â”‚                       â”‚  file_mementos, objects/     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ å¯é€‰åŒæ­¥
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                      â”‚
â”‚                         agent-git-testing-ide                                        â”‚
â”‚                         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                        â”‚
â”‚                              UI & å®¡è®¡å±‚                                              â”‚
â”‚                                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Dashboard     â”‚  â”‚  Session Detail â”‚  â”‚   Audit Trail   â”‚  â”‚  Branch Tree    â”‚ â”‚
â”‚  â”‚   (Web UI)      â”‚  â”‚   (Web UI)      â”‚  â”‚   (API)         â”‚  â”‚  (Visualization)â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                      â”‚
â”‚  PostgreSQL: audit_sessions, audit_events                                            â”‚
â”‚                                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```




Error é›†æˆ ï¼ˆç›®å‰æœ‰agent git error, éœ€è¦ 1.æ ‡å‡†åŒ–æ‰€æœ‰error 2. éœ€è¦ä¸€ä¸ªæŠ½è±¡çš„errorç®¡ç†ï¼‰

---

## 1.4 LangGraph Adapter (PRIMARY - 2026-01-15)

**Decision**: Use LangGraph checkpointers as PRIMARY state persistence for system robustness.

### Why LangGraph First?

| Aspect | LangGraph | AgentGit | Decision |
|--------|-----------|----------|----------|
| **Production-proven** | LangSmith production | Custom implementation | âœ… LangGraph |
| **Thread isolation** | Native `thread_id` | Manual session mgmt | âœ… LangGraph |
| **Time travel** | Built-in `get_state_history()` | Custom rollback | âœ… LangGraph |
| **Checkpointer backends** | Memory, SQLite, PostgreSQL | SQLite only | âœ… LangGraph |
| **Fault tolerance** | Pending writes preserved | Manual | âœ… LangGraph |

### LangGraph Persistence Model

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         LANGGRAPH PERSISTENCE MODEL                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                  â”‚
â”‚  Thread (thread_id)          â† Isolation unit for batch tests                   â”‚
â”‚  â””â”€â”€ Checkpoints (StateSnapshot at each super-step)                             â”‚
â”‚       â”œâ”€â”€ config: {thread_id, checkpoint_id, checkpoint_ns}                     â”‚
â”‚       â”œâ”€â”€ metadata: {source, writes, step}                                      â”‚
â”‚       â”œâ”€â”€ values: State channel values (workflow state)                         â”‚
â”‚       â”œâ”€â”€ next: Tuple of next node names to execute                             â”‚
â”‚       â””â”€â”€ tasks: PregelTask objects with execution info                         â”‚
â”‚                                                                                  â”‚
â”‚  Checkpointer Selection:                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Environment         â”‚ Checkpointer        â”‚ Package                         â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ Unit Tests          â”‚ InMemorySaver       â”‚ langgraph-checkpoint (bundled)  â”‚â”‚
â”‚  â”‚ Development         â”‚ SqliteSaver         â”‚ langgraph-checkpoint-sqlite     â”‚â”‚
â”‚  â”‚ Production          â”‚ PostgresSaver       â”‚ langgraph-checkpoint-postgres   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                                  â”‚
â”‚  Key APIs:                                                                       â”‚
â”‚  â€¢ graph.get_state(config) â†’ Latest StateSnapshot                               â”‚
â”‚  â€¢ graph.get_state_history(config) â†’ Full checkpoint history (time travel)      â”‚
â”‚  â€¢ graph.update_state(config, values, as_node) â†’ Modify state mid-execution     â”‚
â”‚  â€¢ graph.invoke(input, config) with checkpoint_id â†’ Replay from checkpoint      â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### LangGraphStateAdapter Design

```python
# wtb/infrastructure/adapters/langgraph_state_adapter.py (TODO)
from langgraph.checkpoint.postgres import PostgresSaver
from wtb.domain.interfaces import IStateAdapter

class LangGraphStateAdapter(IStateAdapter):
    """PRIMARY state adapter using LangGraph checkpointers."""
    
    def __init__(self, checkpointer: BaseCheckpointSaver):
        self._checkpointer = checkpointer
        self._graph = None  # Compiled workflow graph
    
    def create_checkpoint(self, execution_id: str, state: dict) -> str:
        """Create checkpoint via LangGraph - automatic at each super-step."""
        config = {"configurable": {"thread_id": execution_id}}
        # LangGraph handles checkpointing automatically during invoke()
        return config["configurable"].get("checkpoint_id")
    
    def rollback_to_checkpoint(self, checkpoint_id: str) -> dict:
        """Time travel using LangGraph get_state with checkpoint_id."""
        config = {"configurable": {
            "thread_id": self._current_thread,
            "checkpoint_id": checkpoint_id
        }}
        snapshot = self._graph.get_state(config)
        return snapshot.values
    
    def get_checkpoint_history(self, execution_id: str) -> list:
        """Full time travel history via get_state_history."""
        config = {"configurable": {"thread_id": execution_id}}
        return list(self._graph.get_state_history(config))
```

### State Adapter Priority

| Priority | Adapter | Status | Use Case |
|----------|---------|--------|----------|
| 1 | `LangGraphStateAdapter` | ğŸ†• **TODO (P0)** | Production - robust persistence |
| 2 | `InMemoryStateAdapter` | âœ… Done | Unit testing - no I/O |
| 3 | `AgentGitStateAdapter` | â¸ï¸ **DEFERRED** | Future - interface marked only |

---

## 1.5 AgentGit Dual-Granularity Checkpoints (DEFERRED)

> **ğŸ“‹ IMPLEMENTATION STATUS (2026-01-15)**: 
> The "Dual-Granularity" checkpoint design (Node-Level + Tool/Message Level) described below is **DEFERRED** for future implementation.
>
> **Current Implementation:**
> - **LangGraph (PRIMARY):** Node-level checkpoints only (Super-Step atomicity)
> - **WTB Node Boundaries:** DB + Event control for node entry/exit tracking (âœ… Implemented)
>
> **Deferred Feature:**
> - **AgentGit Tool-Level Checkpoints:** Fine-grained rollback within nodes
> - **Implementation Path:** Requires modeling tools as Sub-Graphs in LangGraph, or custom AgentGit adapter
>
> *The design below represents the full dual-granularity vision for future implementation.*

### è®¾è®¡åŸåˆ™

> **"åŸºäºæœ€å°ç²’åº¦è®¾è®¡ï¼Œåˆ†ç¦»å…³æ³¨ç‚¹ï¼Œåœ¨æ›´é«˜å±‚æ¬¡ç»„åˆã€‚"**

> **"WTB uses LangGraph checkpointers for state persistence; SQLAlchemy UoW for WTB domain data."** (Updated 2026-01-15)

> **"Dual Checkpoint Granularity: Node-level (LangGraph, active) + Tool-level (AgentGit, deferred)."**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ç»Ÿä¸€æ£€æŸ¥ç‚¹è®¾è®¡ (AgentGit Dual-Granularity - DEFERRED)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                  â”‚
â”‚  Current (LangGraph):                                                            â”‚
â”‚  â€¢ Node-level checkpoints (Super-Step atomicity)                                 â”‚
â”‚  â€¢ WTB NodeBoundary: entry_checkpoint_id, exit_checkpoint_id (DB + Event)        â”‚
â”‚                                                                                  â”‚
â”‚  Deferred (AgentGit):                                                            â”‚
â”‚  â€¢ Tool/Message level checkpoints within nodes                                   â”‚
â”‚  â€¢ Finer rollback granularity                                                    â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### èŠ‚ç‚¹æ‰§è¡Œä¸æ£€æŸ¥ç‚¹å…³ç³» (AgentGit Dual-Granularity Design)

> **ğŸ“‹ DEFERRED DESIGN**: The diagram below shows AgentGit's dual-granularity vision with checkpoints at each tool call. This requires AgentGit adapter implementation (deferred).

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         èŠ‚ç‚¹æ‰§è¡Œä¸æ£€æŸ¥ç‚¹å…³ç³» (Dual-Granularity - DEFERRED)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                  â”‚
â”‚  Node: "train"                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                                         â”‚    â”‚
â”‚  â”‚  Tool 1        Tool 2        Tool 3        Tool 4                      â”‚    â”‚
â”‚  â”‚  load_data     preprocess    train_model   save_model                  â”‚    â”‚
â”‚  â”‚     â”‚              â”‚              â”‚              â”‚                      â”‚    â”‚
â”‚  â”‚     â–¼              â–¼              â–¼              â–¼                      â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”                    â”‚    â”‚
â”‚  â”‚  â”‚ CP#5 â”‚      â”‚ CP#6 â”‚      â”‚ CP#7 â”‚      â”‚ CP#8 â”‚                    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”˜                    â”‚    â”‚
â”‚  â”‚     â”‚              â”‚              â”‚              â”‚                      â”‚    â”‚
â”‚  â”‚                                                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                                  â”‚
â”‚  WTB Node Boundary Control (âœ… IMPLEMENTED):                                     â”‚
â”‚  â€¢ NodeBoundary.entry_checkpoint_id â†’ CP#5 (node start)                         â”‚
â”‚  â€¢ NodeBoundary.exit_checkpoint_id  â†’ CP#8 (node end)                           â”‚
â”‚  â€¢ Events: NODE_ENTERED, NODE_EXITED via EventBus                               â”‚
â”‚                                                                                  â”‚
â”‚  Current LangGraph Model:                                                        â”‚
â”‚  â€¢ Node "train" is ONE atomic step. Checkpoint saved AFTER node finishes.        â”‚
â”‚  â€¢ CP#5-#8 collapsed into single checkpoint at node completion.                  â”‚
â”‚                                                                                  â”‚
â”‚  Future AgentGit Model:                                                          â”‚
â”‚  â€¢ Each tool call creates checkpoint (CP#5, CP#6, CP#7, CP#8).                   â”‚
â”‚  â€¢ Enables fine-grained rollback within node execution.                          â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç»Ÿä¸€å›æ»šé€»è¾‘

```python
def rollback(target_checkpoint_id: int):
    """
    ç»Ÿä¸€å›æ»šé€»è¾‘ - æ— è®ºæ˜¯èŠ‚ç‚¹çº§è¿˜æ˜¯å·¥å…·çº§ï¼Œéƒ½æ˜¯å›æ»šåˆ°æ£€æŸ¥ç‚¹ã€‚
    
    "èŠ‚ç‚¹çº§å›æ»š" = è°ƒç”¨è€…ä¼ å…¥ node_boundary.exit_checkpoint_id
    "å·¥å…·çº§å›æ»š" = è°ƒç”¨è€…ä¼ å…¥ä»»æ„ checkpoint.id
    
    å›æ»šé€»è¾‘å®Œå…¨ç›¸åŒã€‚
    """
    # 1. ä» AgentGit åŠ è½½æ£€æŸ¥ç‚¹çŠ¶æ€
    checkpoint = checkpoint_repo.get_by_id(target_checkpoint_id)
    session.restore_from_checkpoint(checkpoint)
    
    # 2. å›æ»šå·¥å…·å‰¯ä½œç”¨ (æ­¤æ£€æŸ¥ç‚¹ä¹‹åçš„)
    tools_to_reverse = tool_invocation_repo.get_after_position(
        session.id, checkpoint.tool_track_position
    )
    for tool in reversed(tools_to_reverse):
        if tool.is_reversible:
            execute_reverse(tool)
    
    # 3. æ¢å¤æ–‡ä»¶çŠ¶æ€ (é€šè¿‡ FileTracker)
    file_link = checkpoint_file_commits_repo.get(checkpoint.id)
    if file_link:
        file_tracker.restore_commit(file_link.file_commit_id)
    
    return checkpoint
```

### æ•°æ®åº“å¤–é”®å…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              æ•°æ®åº“ FK å…³ç³»                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                  â”‚
â”‚  AgentGit Database (SQLite)                                                     â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                   â”‚
â”‚                                                                                  â”‚
â”‚  users (1) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â–º external_sessions (N)                     â”‚
â”‚                                  â”‚                                               â”‚
â”‚  external_sessions (1) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â–º internal_sessions (N)                     â”‚
â”‚                                  â”‚                                               â”‚
â”‚  internal_sessions (1) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â–º checkpoints (N)                           â”‚
â”‚                                  â”‚                                               â”‚
â”‚                                  â”œâ”€â”€â–º node_boundaries (N)                       â”‚
â”‚                                  â”‚       â”œâ”€â”€ entry_checkpoint_id FK â†’ checkpointsâ”‚
â”‚                                  â”‚       â””â”€â”€ exit_checkpoint_id FK â†’ checkpoints â”‚
â”‚                                  â”‚                                               â”‚
â”‚                                  â””â”€â”€â–º tool_invocations (N)                       â”‚
â”‚                                          â””â”€â”€ checkpoint_id FK â†’ checkpoints      â”‚
â”‚                                                                                  â”‚
â”‚  checkpoints (1) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º checkpoint_file_commits (0..1)           â”‚
â”‚                                            â”‚                                     â”‚
â”‚                                            â”‚ file_commit_id                      â”‚
â”‚                                            â–¼                                     â”‚
â”‚  â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€  â”‚
â”‚                                                                                  â”‚
â”‚  FileTracker Database (PostgreSQL)                                              â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                              â”‚
â”‚                                                                                  â”‚
â”‚  commits (commit_id PK) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º file_mementos (N)                        â”‚
â”‚                                            â”‚                                     â”‚
â”‚                                            â”‚ file_hash FK                        â”‚
â”‚                                            â–¼                                     â”‚
â”‚  file_blobs (content_hash PK) â—„â”€â”€â”€â”€â”€â”€â”€â”€ file_mementos.file_hash                 â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## LLM Infra

1. Traj path data -> llm
2. workflow (node n) -> frezze , train node_llm
3. system -> restful api -> llm tool calling

## 2. ä¸‰ç³»ç»Ÿåä½œå…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ç³»ç»ŸèŒè´£åˆ†å·¥                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚   WTB (Workflow Test Bench)           "å¤§è„‘" - å†³ç­–ä¸ç¼–æ’                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  â€¢ å·¥ä½œæµå®šä¹‰ä¸è§£æ                                                       â”‚  â”‚
â”‚   â”‚  â€¢ æ‰§è¡Œæ§åˆ¶ (ä½•æ—¶è¿è¡Œã€ä½•æ—¶æš‚åœ)                                           â”‚  â”‚
â”‚   â”‚  â€¢ èŠ‚ç‚¹æ›¿æ¢ä¸å˜ä½“ç®¡ç†                                                     â”‚  â”‚
â”‚   â”‚  â€¢ æ‰¹é‡æµ‹è¯•è°ƒåº¦                                                          â”‚  â”‚
â”‚   â”‚  â€¢ è¯„ä¼°ä¸æ‰“åˆ†                                                            â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                      â”‚                                          â”‚
â”‚                                      â”‚ å§”æ‰˜                                     â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚                    â–¼                                   â–¼                       â”‚
â”‚   AgentGit v0.2.0                     FileTracker                              â”‚
â”‚   "è®°å¿†" - çŠ¶æ€ä¸å›æ»š                  "æ¡£æ¡ˆ" - æ–‡ä»¶ç‰ˆæœ¬                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚   â”‚  â€¢ ä¿å­˜æ‰§è¡ŒçŠ¶æ€å¿«ç…§        â”‚      â”‚  â€¢ ä¿å­˜æ–‡ä»¶å†…å®¹            â”‚            â”‚
â”‚   â”‚  â€¢ ç®¡ç†åˆ†æ”¯æ ‘              â”‚      â”‚  â€¢ è¿½è¸ªæ–‡ä»¶å˜æ›´            â”‚            â”‚
â”‚   â”‚  â€¢ å›æ»šå·¥å…·å‰¯ä½œç”¨          â”‚      â”‚  â€¢ æ¢å¤å†å²ç‰ˆæœ¬            â”‚            â”‚
â”‚   â”‚  â€¢ è¿½è¸ªå·¥å…·è°ƒç”¨å†å²        â”‚      â”‚  â€¢ å»é‡å­˜å‚¨                â”‚            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                                 â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚                    â–¼                                                           â”‚
â”‚   agent-git-testing-ide                                                        â”‚
â”‚   "çª—å£" - å¯è§†åŒ–ä¸å®¡è®¡                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  â€¢ æä¾› Web ç•Œé¢å±•ç¤ºæµ‹è¯•çŠ¶æ€                                              â”‚  â”‚
â”‚   â”‚  â€¢ è®°å½•æ‰€æœ‰æ“ä½œçš„å®¡è®¡æ—¥å¿—                                                 â”‚  â”‚
â”‚   â”‚  â€¢ å¯è§†åŒ–åˆ†æ”¯æ ‘å’Œæ‰§è¡Œè·¯å¾„                                                 â”‚  â”‚
â”‚   â”‚  â€¢ æä¾›å®æ—¶ç›‘æ§ (WebSocket)                                              â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. æ•°æ®æµå›¾

### 3.1 æ ¸å¿ƒæ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              æ•°æ®æµå‘                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç”¨æˆ·è¾“å…¥                    WTB å¤„ç†                     å¤–éƒ¨å­˜å‚¨
â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”€â”€â”€â”€â”€â”€â”€â”€â”€                    â”€â”€â”€â”€â”€â”€â”€â”€â”€

  Workflow               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  Definition  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   è§£æå¹¶    â”‚
  (YAML/JSON)            â”‚   åˆ›å»º      â”‚â”€â”€â”€â”€â”€â”€â”
                         â”‚  TestWorkflowâ”‚      â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
                                              â”‚
                                              â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  Execute    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚  Execution  â”‚â”€â”€â–ºâ”‚ AgentGit         â”‚
  Command                â”‚  Controller â”‚   â”‚ â€¢ save checkpointâ”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â€¢ create session â”‚
                               â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ FileTracker      â”‚
                         â”‚    Node     â”‚â”€â”€â–ºâ”‚ â€¢ save blob      â”‚
                         â”‚  Executor   â”‚   â”‚ â€¢ create memento â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â”‚
                               â–¼           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ IDE              â”‚
                         â”‚  Evaluation â”‚â”€â”€â–ºâ”‚ â€¢ audit event    â”‚
                         â”‚   Engine    â”‚   â”‚ â€¢ metrics        â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  Results    â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   Report    â”‚
  & Metrics              â”‚  Generator  â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 çŠ¶æ€åŒæ­¥æ•°æ®æµ (åè°ƒæ£€æŸ¥ç‚¹æ¨¡å¼)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         çŠ¶æ€æ•°æ®åœ¨ä¸‰ç³»ç»Ÿé—´çš„æµåŠ¨                                   â”‚
â”‚                    (åŸºäºæœ€å°ç²’åº¦è®¾è®¡ - æ¯ä¸ªå·¥å…·è°ƒç”¨åˆ›å»ºæ£€æŸ¥ç‚¹)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    â‘  æ‰§è¡Œå‰: åˆå§‹åŒ–
                    â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

WTB                          AgentGit                      IDE
 â”‚                              â”‚                           â”‚
 â”‚ â”€â”€â”€ create session â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚                           â”‚
 â”‚                              â”‚ â”€â”€â”€ create internal â”€â”€â”€â”€â–º â”‚ (sync)
 â”‚ â—„â”€â”€ session_id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚      session              â”‚
 â”‚                              â”‚                           â”‚


                    â‘¡ æ‰§è¡Œä¸­: æ¯ä¸ªå·¥å…·è°ƒç”¨æ—¶
                    â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

WTB                          AgentGit                      FileTracker           IDE
 â”‚                              â”‚                              â”‚                   â”‚
 â”‚ â”€â”€â”€â”€ execute_tool() â”€â”€â”€â”€â”€â”€â”€â–º â”‚                              â”‚                   â”‚
 â”‚                              â”‚                              â”‚                   â”‚
 â”‚                              â”‚ â”€ create checkpoint â”€â”€â”€â”€â”€â”€â”€â–º â”‚                   â”‚
 â”‚                              â”‚   (å·¥å…·çº§, tool_track_pos++)  â”‚                   â”‚
 â”‚                              â”‚                              â”‚                   â”‚
 â”‚ â”€â”€â”€â”€ track_files(paths) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º                   â”‚
 â”‚                              â”‚                              â”‚                   â”‚
 â”‚                              â”‚ â—„â”€â”€ file_commit_id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚
 â”‚                              â”‚                              â”‚                   â”‚
 â”‚                              â”‚ â”€ link checkpoint â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚
 â”‚                              â”‚   to file_commit             â”‚                   â”‚
 â”‚                              â”‚   (checkpoint_file_commits)  â”‚                   â”‚
 â”‚                              â”‚                              â”‚                   â”‚
 â”‚ â”€ sync_event(TOOL_END) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
 â”‚                              â”‚                              â”‚                   â”‚


                    â‘¢ èŠ‚ç‚¹å®Œæˆæ—¶: åˆ›å»ºè¾¹ç•Œæ ‡è®° (ä¸æ˜¯æ–°æ£€æŸ¥ç‚¹!)
                    â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

WTB                          AgentGit                      FileTracker           IDE
 â”‚                              â”‚                              â”‚                   â”‚
 â”‚ â”€ on_node_complete(node_id)â”€â–ºâ”‚                              â”‚                   â”‚
 â”‚                              â”‚                              â”‚                   â”‚
 â”‚                              â”‚ â”€ create node_boundary â”€â”€â”€â”€â–º â”‚                   â”‚
 â”‚                              â”‚   entry_cp_id = first_cp     â”‚                   â”‚
 â”‚                              â”‚   exit_cp_id = last_cp       â”‚                   â”‚
 â”‚                              â”‚   (æŒ‡å‘å·²æœ‰æ£€æŸ¥ç‚¹ï¼Œä¸åˆ›å»ºæ–°çš„) â”‚                   â”‚
 â”‚                              â”‚                              â”‚                   â”‚
 â”‚ â”€ sync_event(NODE_COMPLETE) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
 â”‚                              â”‚                              â”‚                   â”‚


                    â‘£ å›æ»šæ—¶: ç»Ÿä¸€é€»è¾‘
                    â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

WTB                          AgentGit                      FileTracker           IDE
 â”‚                              â”‚                              â”‚                   â”‚
 â”‚ â”€ rollback(checkpoint_id) â”€â–º â”‚                              â”‚                   â”‚
 â”‚   (å¯ä»¥æ˜¯ä»»æ„æ£€æŸ¥ç‚¹:          â”‚                              â”‚                   â”‚
 â”‚    èŠ‚ç‚¹çº§ = exit_cp_id       â”‚                              â”‚                   â”‚
 â”‚    å·¥å…·çº§ = ä»»æ„ cp.id)       â”‚                              â”‚                   â”‚
 â”‚                              â”‚                              â”‚                   â”‚
 â”‚                              â”‚ â”€ load checkpoint â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚                   â”‚
 â”‚                              â”‚                              â”‚                   â”‚
 â”‚                              â”‚ â”€ get tools after position â”€â–ºâ”‚                   â”‚
 â”‚                              â”‚                              â”‚                   â”‚
 â”‚                              â”‚ â”€ reverse tools (LIFO) â”€â”€â”€â”€â”€â–ºâ”‚                   â”‚
 â”‚                              â”‚                              â”‚                   â”‚
 â”‚                              â”‚ â”€ get file_commit_id â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚
 â”‚                              â”‚   from checkpoint_file_      â”‚                   â”‚
 â”‚                              â”‚   commits table              â”‚                   â”‚
 â”‚                              â”‚                              â”‚                   â”‚
 â”‚                              â”‚                              â”‚ â—„â”€ restore â”€â”€â”€â”€â”€  â”‚
 â”‚                              â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚   files           â”‚
 â”‚                              â”‚                              â”‚                   â”‚
 â”‚ â—„â”€ restored_state â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚                              â”‚                   â”‚
 â”‚                              â”‚                              â”‚                   â”‚
 â”‚ â”€ sync_event(ROLLBACK) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
 â”‚                              â”‚                              â”‚                   â”‚
```

### 3.3 æ£€æŸ¥ç‚¹ä¸æ–‡ä»¶æäº¤çš„é“¾æ¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Checkpoint â†” FileTracker å…³è”                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  AgentGit                           é“¾æ¥è¡¨                          FileTracker
  â•â•â•â•â•â•â•â•                           â•â•â•â•â•â•                          â•â•â•â•â•â•â•â•â•â•â•

  checkpoints                 checkpoint_file_commits               commits
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ id: 42     â”‚              â”‚ checkpoint_id: 42   â”‚              â”‚commit_id:  â”‚
  â”‚ data: {...}â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ file_commit_id: â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ "abc123"   â”‚
  â”‚ node_id:   â”‚              â”‚   "abc123"          â”‚              â”‚            â”‚
  â”‚  "train"   â”‚              â”‚ file_count: 3       â”‚              â”‚ mementos:  â”‚
  â”‚            â”‚              â”‚ total_size: 1.2MB   â”‚              â”‚ â”œâ”€ model.pkl
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚ â”œâ”€ config.json
                                                                    â”‚ â””â”€ logs.txt
                                                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                           â”‚
                                                                           â–¼
                                                                    file_blobs
                                                                    (å»é‡å­˜å‚¨)
```

---

## 4. ç”¨æˆ·æ“ä½œæµç¨‹ (Dummy Flows)

### Flow 1: ç”¨æˆ·ä¸Šä¼ å¹¶æ‰§è¡Œå·¥ä½œæµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Flow 1: åŸºæœ¬å·¥ä½œæµæ‰§è¡Œ                                                          â”‚
â”‚  ç”¨æˆ·ç›®æ ‡: ä¸Šä¼ å·¥ä½œæµå®šä¹‰ï¼Œæ‰§è¡Œå¹¶æŸ¥çœ‹ç»“æœ                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç”¨æˆ·æ“ä½œ                          ç³»ç»Ÿå“åº”                        æ•°æ®å­˜å‚¨
â”â”â”â”â”â”â”                          â”â”â”â”â”â”â”                        â”â”â”â”â”â”â”

 â‘  ä¸Šä¼ å·¥ä½œæµ YAML
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ name: "ML Pipeline"â”‚
    â”‚ nodes:            â”‚
    â”‚   - data_load     â”‚
    â”‚   - preprocess    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  WTB è§£æ
    â”‚   - train         â”‚              åˆ›å»º TestWorkflow
    â”‚   - evaluate      â”‚                    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
                                             â–¼
                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                      â”‚ workflow_id â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º SQLite/PostgreSQL
                                      â”‚ = "wf_001"  â”‚            wtb_workflows è¡¨
                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

 â‘¡ ç‚¹å‡» "æ‰§è¡Œ"
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ initial_state:   â”‚
    â”‚   data_path: ... â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  WTB å¯åŠ¨æ‰§è¡Œ
    â”‚   params: {...}  â”‚              ExecutionController
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
                                            â”‚
                                            â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ Node: data_loadâ”‚
                          â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚                 â”‚
                          â–¼                 â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     AgentGit åˆ›å»º
                    â”‚ AgentGit â”‚     checkpoint #1 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º agentgit.db
                    â”‚ Adapter  â”‚                               checkpoints è¡¨
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â”‚ (é‡å¤æ¯ä¸ªèŠ‚ç‚¹)
                          â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Node: train   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼ äº§ç”Ÿæ¨¡å‹æ–‡ä»¶
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ FileTracker  â”‚
                    â”‚ save model.pklâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º objects/ab/cdef...
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            file_blobs è¡¨

 â‘¢ å®æ—¶æŸ¥çœ‹è¿›åº¦
    (Web UI)         â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  IDE WebSocket
                                       æ¨é€äº‹ä»¶ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º audit_events è¡¨


 â‘£ æ‰§è¡Œå®Œæˆï¼ŒæŸ¥çœ‹ç»“æœ
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Results:         â”‚
    â”‚ - accuracy: 0.95 â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  WTB Evaluation
    â”‚ - latency: 2.3s  â”‚              Engine èšåˆ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º wtb_evaluation_results
    â”‚ - cost: $0.05    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Flow 2: æ‰¹é‡æµ‹è¯•èŠ‚ç‚¹å˜ä½“

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Flow 2: æ‰¹é‡ A/B æµ‹è¯•                                                           â”‚
â”‚  ç”¨æˆ·ç›®æ ‡: æ¯”è¾ƒ3ç§ä¸åŒçš„è®­ç»ƒç®—æ³•ï¼Œæ‰¾å‡ºæœ€ä¼˜æ–¹æ¡ˆ                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç”¨æˆ·æ“ä½œ                          ç³»ç»Ÿå“åº”                        æ•°æ®å­˜å‚¨
â”â”â”â”â”â”â”                          â”â”â”â”â”â”â”                        â”â”â”â”â”â”â”

 â‘  æ³¨å†ŒèŠ‚ç‚¹å˜ä½“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ train_node variants:  â”‚
    â”‚   - v1: RandomForest  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  WTB NodeReplacer
    â”‚   - v2: XGBoost       â”‚           æ³¨å†Œåˆ° VariantRegistry â”€â”€â”€â–º wtb_node_variants è¡¨
    â”‚   - v3: NeuralNet     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

 â‘¡ é…ç½®æ‰¹é‡æµ‹è¯•
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ BatchTestConfig:      â”‚
    â”‚   workflow: "wf_001"  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  WTB åˆ›å»ºé…ç½®
    â”‚   variants:           â”‚
    â”‚     - {train: v1}     â”‚
    â”‚     - {train: v2}     â”‚
    â”‚     - {train: v3}     â”‚
    â”‚   parallel: 3         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

 â‘¢ å¯åŠ¨æ‰¹é‡æµ‹è¯•
    "å¼€å§‹æµ‹è¯•"  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  WTB BatchTestRunner
                                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                         â”‚                         â”‚
                    â–¼                         â–¼                         â–¼
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚ Variant A  â”‚           â”‚ Variant B  â”‚           â”‚ Variant C  â”‚
             â”‚ (RF)       â”‚           â”‚ (XGB)      â”‚           â”‚ (NN)       â”‚
             â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                   â”‚                        â”‚                        â”‚
                   â”‚     å¹¶è¡Œæ‰§è¡Œï¼Œå„è‡ªç‹¬ç«‹åˆ†æ”¯                        â”‚
                   â”‚                        â”‚                        â”‚
                   â–¼                        â–¼                        â–¼
             AgentGit                  AgentGit                  AgentGit
             Session A                Session B                Session C
             Checkpoint A1            Checkpoint B1            Checkpoint C1
                   â”‚                        â”‚                        â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                            â”‚
                                            â–¼
 â‘£ æŸ¥çœ‹å¯¹æ¯”ç»“æœ
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Comparison Matrix                                               â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
    â”‚  â”‚ Variant  â”‚ Accuracy â”‚ Latency  â”‚  Cost    â”‚  Overall â”‚       â”‚
    â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚
    â”‚  â”‚ v1 (RF)  â”‚  0.92    â”‚  1.2s    â”‚  $0.02   â”‚  0.85    â”‚       â”‚
    â”‚  â”‚ v2 (XGB) â”‚  0.95 âœ“  â”‚  2.1s    â”‚  $0.03   â”‚  0.88 âœ“  â”‚ â—„â”€Bestâ”‚
    â”‚  â”‚ v3 (NN)  â”‚  0.94    â”‚  5.3s    â”‚  $0.15   â”‚  0.72    â”‚       â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
    â”‚                                                                  â”‚
    â”‚  Recommendation: Use v2 (XGBoost) - best overall score          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                            â”‚
                                            â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚ wtb_batch_testsâ”‚
                                    â”‚ comparison_   â”‚
                                    â”‚ matrix (JSON) â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Flow 3: æš‚åœ-æ£€æŸ¥-ä¿®æ”¹-æ¢å¤

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Flow 3: è°ƒè¯•å·¥ä½œæµ (æš‚åœä¸æ¢å¤)                                                  â”‚
â”‚  ç”¨æˆ·ç›®æ ‡: åœ¨ç‰¹å®šèŠ‚ç‚¹æš‚åœï¼Œæ£€æŸ¥çŠ¶æ€ï¼Œä¿®æ”¹å‚æ•°åç»§ç»­                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç”¨æˆ·æ“ä½œ                          ç³»ç»Ÿå“åº”                        æ•°æ®å­˜å‚¨
â”â”â”â”â”â”â”                          â”â”â”â”â”â”â”                        â”â”â”â”â”â”â”

 â‘  è®¾ç½®æ–­ç‚¹
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ breakpoints:          â”‚
    â”‚   - "preprocess"      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  WTB è®°å½•æ–­ç‚¹
    â”‚   - "train"           â”‚           PauseStrategy
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

 â‘¡ å¯åŠ¨æ‰§è¡Œ
    "æ‰§è¡Œ"  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  å¼€å§‹æ‰§è¡Œ
                                              â”‚
                                              â–¼
                                        data_load âœ“
                                              â”‚
                                              â–¼
                                        preprocess
                                         â¸ï¸ æš‚åœ!
                                              â”‚
                                              â–¼
                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                     â”‚ åˆ›å»º Snapshot â”‚
                                     â”‚ â€¢ å½“å‰çŠ¶æ€    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º AgentGit
                                     â”‚ â€¢ ä¸­é—´æ•°æ®    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º FileTracker
                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

 â‘¢ æ£€æŸ¥å½“å‰çŠ¶æ€
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Current State:                          â”‚
    â”‚ {                                       â”‚
    â”‚   "data": <DataFrame 1000 rows>,        â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  WTB è¿”å›
    â”‚   "preprocessing_params": {             â”‚            å½“å‰çŠ¶æ€
    â”‚     "normalize": true,                  â”‚
    â”‚     "fill_na": "mean"                   â”‚
    â”‚   }                                     â”‚
    â”‚ }                                       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

 â‘£ ä¿®æ”¹çŠ¶æ€
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ modified_state:       â”‚
    â”‚   fill_na: "median"   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  WTB æ›´æ–°
    â”‚   add_feature: true   â”‚           å†…å­˜çŠ¶æ€
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

 â‘¤ æ¢å¤æ‰§è¡Œ
    "ç»§ç»­"  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  WTB resume()
                                              â”‚
                                              â–¼
                                        preprocess âœ“ (ä½¿ç”¨æ–°å‚æ•°)
                                              â”‚
                                              â–¼
                                        train
                                         â¸ï¸ æš‚åœ!
                                              â”‚
                                              â–¼
                                      (ç”¨æˆ·å¯ä»¥ç»§ç»­è°ƒè¯•...)

 â‘¥ å›æ»šåˆ°ä¹‹å‰çŠ¶æ€
    "å›æ»šåˆ° preprocess ä¹‹å‰"  â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  WTB rollback()
                                              â”‚
                                              â”œâ”€â”€â”€â”€â”€â–º AgentGit: æ¢å¤çŠ¶æ€
                                              â”‚
                                              â”œâ”€â”€â”€â”€â”€â–º FileTracker: æ¢å¤æ–‡ä»¶
                                              â”‚
                                              â–¼
                                      å›åˆ° data_load âœ“ ä¹‹åçš„çŠ¶æ€
```

### Flow 4: é”™è¯¯æ¢å¤ä¸é‡è¯•

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Flow 4: é”™è¯¯å¤„ç†ä¸æ¢å¤                                                          â”‚
â”‚  ç”¨æˆ·ç›®æ ‡: èŠ‚ç‚¹æ‰§è¡Œå¤±è´¥åï¼Œä¿®å¤é—®é¢˜å¹¶ä»å¤±è´¥ç‚¹æ¢å¤                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ‰§è¡Œè¿‡ç¨‹                          ç³»ç»Ÿå“åº”                        ç”¨æˆ·æ“ä½œ
â”â”â”â”â”â”â”                          â”â”â”â”â”â”â”                        â”â”â”â”â”â”â”

 data_load âœ“
      â”‚
      â–¼
 preprocess âœ“   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  Checkpoint #2 ä¿å­˜
      â”‚
      â–¼
 train âŒ å¤±è´¥!
 Error: "CUDA out of memory"
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WTB æ•è·é”™è¯¯                         â”‚
â”‚ â€¢ è®°å½•é”™è¯¯è¯¦æƒ…                       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º IDE audit_events
â”‚ â€¢ ä¿å­˜å¤±è´¥æ—¶çš„çŠ¶æ€                   â”‚              severity: "error"
â”‚ â€¢ ä¸åˆ›å»ºæ–° checkpoint               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                    ç”¨æˆ·æŸ¥çœ‹é”™è¯¯:
                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                              â”‚ Error in train node:    â”‚
                                              â”‚ CUDA out of memory      â”‚
                                              â”‚                         â”‚
                                              â”‚ Last checkpoint: #2     â”‚
                                              â”‚ (preprocess)            â”‚
                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                           â”‚
                                                           â–¼
                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                              â”‚ ç”¨æˆ·ä¿®æ”¹é…ç½®:            â”‚
                                              â”‚ batch_size: 32 â†’ 16     â”‚
                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                           â”‚
                                                           â–¼
                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                              â”‚ "ä» Checkpoint #2 æ¢å¤"  â”‚
                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                           â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WTB æ¢å¤æµç¨‹:                        â”‚
â”‚ 1. ä» AgentGit åŠ è½½ Checkpoint #2   â”‚
â”‚ 2. æ¢å¤ workflow_variables          â”‚
â”‚ 3. æ¢å¤ FileTracker æ–‡ä»¶çŠ¶æ€        â”‚
â”‚ 4. åº”ç”¨ç”¨æˆ·ä¿®æ”¹ (batch_size)        â”‚
â”‚ 5. ä» train èŠ‚ç‚¹é‡æ–°å¼€å§‹            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
 train âœ“ (ä½¿ç”¨æ–° batch_size)
      â”‚
      â–¼
 evaluate âœ“
      â”‚
      â–¼
 å®Œæˆ! âœ“
```

---

## 5. æ•°æ®å­˜å‚¨åˆ†å¸ƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              æ•°æ®å­˜å‚¨ä½ç½®æ€»è§ˆ                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WTB å­˜å‚¨æŠ½è±¡å±‚ (Dual Implementation Pattern)                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                     â”‚
â”‚                                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                         IUnitOfWork (æ¥å£)                                  â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ workflows: IWorkflowRepository                                        â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ executions: IExecutionRepository                                      â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ node_boundaries: INodeBoundaryRepository                              â”‚ â”‚
â”‚  â”‚  â””â”€â”€ checkpoint_files: ICheckpointFileRepository                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                           â”‚                     â”‚                               â”‚
â”‚                           â–¼                     â–¼                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚     InMemoryUnitOfWork      â”‚   â”‚   SQLAlchemyUnitOfWork      â”‚             â”‚
â”‚  â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚   â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚             â”‚
â”‚  â”‚   â€¢ å•å…ƒæµ‹è¯•                 â”‚   â”‚   â€¢ ç”Ÿäº§ç¯å¢ƒ                 â”‚             â”‚
â”‚  â”‚   â€¢ å¿«é€Ÿè¿­ä»£                 â”‚   â”‚   â€¢ SQLite/PostgreSQL       â”‚             â”‚
â”‚  â”‚   â€¢ æ—  I/O å¼€é”€             â”‚   â”‚   â€¢ æ•°æ®æŒä¹…åŒ–               â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                                  â”‚
â”‚  åˆ‡æ¢æ–¹å¼: UnitOfWorkFactory.create(mode="inmemory|sqlalchemy")                 â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WTB ä¸“ç”¨å­˜å‚¨ (SQLite/PostgreSQL - SQLAlchemyUnitOfWork æ¨¡å¼)                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                       â”‚
â”‚                                                                                  â”‚
â”‚  wtb_workflows          å·¥ä½œæµå®šä¹‰                                                â”‚
â”‚  wtb_executions         æ‰§è¡Œè®°å½•ä¸çŠ¶æ€                                            â”‚
â”‚  wtb_node_boundaries    èŠ‚ç‚¹è¾¹ç•Œ (æŒ‡å‘ AgentGit checkpoint çš„æŒ‡é’ˆ)                â”‚
â”‚  wtb_checkpoint_files   æ£€æŸ¥ç‚¹æ–‡ä»¶é“¾æ¥ (é“¾æ¥ AgentGit ä¸ FileTracker)             â”‚
â”‚  wtb_node_variants      èŠ‚ç‚¹å˜ä½“é…ç½®                                              â”‚
â”‚  wtb_evaluation_results è¯„ä¼°ç»“æœ                                                  â”‚
â”‚  wtb_batch_tests        æ‰¹é‡æµ‹è¯•è®°å½•                                              â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â”‚ å…³è”
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AgentGit å­˜å‚¨ (SQLite: agentgit.db)                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                            â”‚
â”‚                                                                                  â”‚
â”‚  external_sessions    å¤–éƒ¨ä¼šè¯ (ç”¨æˆ·çº§)                                           â”‚
â”‚  internal_sessions    å†…éƒ¨ä¼šè¯ (åˆ†æ”¯çº§)                                           â”‚
â”‚  checkpoints          çŠ¶æ€å¿«ç…§                                                   â”‚
â”‚  users                ç”¨æˆ·ä¿¡æ¯                                                   â”‚
â”‚                                                                                  â”‚
â”‚  å…ƒæ•°æ®æ‰©å±• (checkpoints.metadata):                                               â”‚
â”‚  â€¢ wtb_execution_id   å…³è” WTB æ‰§è¡Œ                                              â”‚
â”‚  â€¢ file_artifacts     æ–‡ä»¶å˜æ›´è®°å½•                                                â”‚
â”‚  â€¢ mdp_state          MDP çŠ¶æ€æ•°æ®                                               â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â”‚ å…³è”
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FileTracker å­˜å‚¨ (PostgreSQL + æ–‡ä»¶ç³»ç»Ÿ)                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                       â”‚
â”‚                                                                                  â”‚
â”‚  PostgreSQL:                                                                     â”‚
â”‚  commits              æäº¤è®°å½•                                                   â”‚
â”‚  file_blobs           Blob å…ƒæ•°æ® (hash -> location)                             â”‚
â”‚  file_mementos        æ–‡ä»¶å¿«ç…§è®°å½•                                                â”‚
â”‚                                                                                  â”‚
â”‚  æ–‡ä»¶ç³»ç»Ÿ (objects/):                                                             â”‚
â”‚  objects/ab/cdef...   å®é™…æ–‡ä»¶å†…å®¹ (SHA-256 åˆ†ç‰‡å­˜å‚¨)                              â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â”‚ å…³è” (å¯é€‰)
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  IDE å­˜å‚¨ (PostgreSQL)                                                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                          â”‚
â”‚                                                                                  â”‚
â”‚  audit_sessions       å®¡è®¡ä¼šè¯                                                   â”‚
â”‚  audit_events         å®¡è®¡äº‹ä»¶ (å·¥å…·è°ƒç”¨ã€é”™è¯¯ã€LLMè°ƒç”¨ç­‰)                          â”‚
â”‚  test_runs            æµ‹è¯•è¿è¡Œè®°å½•                                                â”‚
â”‚                                                                                  â”‚
â”‚  å…³è”å­—æ®µ:                                                                        â”‚
â”‚  â€¢ audit_sessions.metadata.wtb_execution_id                                      â”‚
â”‚  â€¢ audit_events.details.wtb_node_id                                              â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5.5 å¹¶è¡Œä¼šè¯è®¾è®¡ (Parallel Internal Sessions)

### è®¾è®¡ç›®æ ‡

BatchTestRunner éœ€è¦**å¹¶è¡Œæ‰§è¡Œ**å¤šä¸ª variant ç»„åˆï¼Œæ¯ä¸ªå¹¶è¡Œæ‰§è¡Œéœ€è¦ç‹¬ç«‹çš„ä¸Šä¸‹æ–‡ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å¹¶è¡Œä¼šè¯éš”ç¦»æ¶æ„                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                  â”‚
â”‚  BatchTestRunner                                                                â”‚
â”‚       â”‚                                                                          â”‚
â”‚       â”œâ”€â”€ ParallelContextFactory.create_context(variant_a)                      â”‚
â”‚       â”‚       â””â”€â”€ Context A: Adapter A + Controller A + Session A               â”‚
â”‚       â”‚                                                                          â”‚
â”‚       â”œâ”€â”€ ParallelContextFactory.create_context(variant_b)                      â”‚
â”‚       â”‚       â””â”€â”€ Context B: Adapter B + Controller B + Session B               â”‚
â”‚       â”‚                                                                          â”‚
â”‚       â””â”€â”€ ThreadPoolExecutor / asyncio.gather()                                 â”‚
â”‚               â”‚                                                                  â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             â”‚
â”‚       â”‚       â”‚                   â”‚                                             â”‚
â”‚       â–¼       â–¼                   â–¼                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚  â”‚Context â”‚  â”‚Context â”‚ ...  â”‚Context â”‚                                        â”‚
â”‚  â”‚   A    â”‚  â”‚   B    â”‚      â”‚   N    â”‚                                        â”‚
â”‚  â”‚        â”‚  â”‚        â”‚      â”‚        â”‚                                        â”‚
â”‚  â”‚Session â”‚  â”‚Session â”‚      â”‚Session â”‚    â† æ¯ä¸ª context ç‹¬ç«‹çš„ session        â”‚
â”‚  â”‚  A     â”‚  â”‚  B     â”‚      â”‚  N     â”‚                                        â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜                                        â”‚
â”‚       â”‚           â”‚               â”‚                                             â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                             â”‚
â”‚                   â”‚                                                              â”‚
â”‚                   â–¼                                                              â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                 â”‚
â”‚       â”‚   AgentGit Database   â”‚                                                 â”‚
â”‚       â”‚   (WAL Mode å¯ç”¨)      â”‚   â† SQLite WAL æ¨¡å¼æ”¯æŒå¹¶å‘å†™å…¥                  â”‚
â”‚       â”‚                       â”‚                                                 â”‚
â”‚       â”‚ internal_sessions:    â”‚                                                 â”‚
â”‚       â”‚ â”œâ”€â”€ Session A (id=1)  â”‚                                                 â”‚
â”‚       â”‚ â”œâ”€â”€ Session B (id=2)  â”‚                                                 â”‚
â”‚       â”‚ â””â”€â”€ Session N (id=N)  â”‚                                                 â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                 â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…³é”®è®¾è®¡å†³ç­–

| é—®é¢˜ | è§£å†³æ–¹æ¡ˆ |
|------|----------|
| StateAdapter æ˜¯æœ‰çŠ¶æ€çš„ (`_current_session`) | æ¯ä¸ªå¹¶è¡Œæ‰§è¡Œåˆ›å»ºç‹¬ç«‹çš„ Adapter å®ä¾‹ |
| SQLite é»˜è®¤ä¸æ”¯æŒå¹¶å‘å†™å…¥ | å¯ç”¨ WAL (Write-Ahead Logging) æ¨¡å¼ |
| ä¼šè¯èµ„æºæ³„æ¼ | SessionLifecycleManager å®šæ—¶æ¸…ç†è¶…æ—¶ä¼šè¯ |
| çº¿ç¨‹å®‰å…¨ | ThreadPoolExecutor + å®Œå…¨éš”ç¦»çš„ context |

### æ ¸å¿ƒç»„ä»¶

```
ParallelExecutionContext
â”œâ”€â”€ ExecutionController instance (ç‹¬ç«‹)
â”œâ”€â”€ AgentGitStateAdapter instance (ç‹¬ç«‹)
â”œâ”€â”€ UnitOfWork instance (ç‹¬ç«‹ DB session)
â””â”€â”€ VariantCombination (é…ç½®)

ParallelContextFactory
â””â”€â”€ create_context(variant) â†’ ParallelExecutionContext

BatchTestRunner
â”œâ”€â”€ run_batch_test(batch_test) â†’ åè°ƒå¹¶è¡Œæ‰§è¡Œ
â””â”€â”€ _run_single_variant(context) â†’ åœ¨ç‹¬ç«‹ context ä¸­è¿è¡Œ
```

### è¯¦ç»†è®¾è®¡

å‚è§: `docs/Project_Init/WORKFLOW_TEST_BENCH_ARCHITECTURE.md` Section 16

---

## 6. å¿«é€Ÿå‚è€ƒ

### API ç«¯ç‚¹å¯¹ç…§

| åŠŸèƒ½     | WTB ç«¯ç‚¹                               | AgentGit æ¥å£                                  | IDE ç«¯ç‚¹                                      |
| -------- | -------------------------------------- | ---------------------------------------------- | --------------------------------------------- |
| åˆ›å»ºä¼šè¯ | `POST /api/executions`               | `InternalSessionRepository.create()`         | `POST /api/operations/agents/create`        |
| æ‰§è¡Œ     | `POST /api/executions/{id}/run`      | `RollbackAgent_mdp.run()`                    | `POST /api/operations/agents/{id}/send`     |
| æš‚åœ     | `POST /api/executions/{id}/pause`    | -                                              | -                                             |
| æ¢å¤     | `POST /api/executions/{id}/resume`   | -                                              | `POST /api/plan/step/{id}/execute`          |
| å›æ»š     | `POST /api/executions/{id}/rollback` | `RollbackAgent_mdp.rollback_to_checkpoint()` | `POST /api/operations/agents/{id}/rollback` |
| è·å–çŠ¶æ€ | `GET /api/executions/{id}`           | `CheckpointManager_mdp.get_checkpoint()`     | `GET /api/audit/sessions/{id}`              |
| æ‰¹é‡æµ‹è¯• | `POST /api/batch-tests`              | `MDPBranchHelper.execute_branches()`         | -                                             |
| è¯„ä¼°     | `GET /api/executions/{id}/evaluate`  | -                                              | `GET /api/audit/sessions/{id}/summary`      |

### é…ç½®æ¨¡å¼

```yaml
# æœ€å°é…ç½® (å•å…ƒæµ‹è¯• - å…¨å†…å­˜)
mode: testing
state_adapter: inmemory           # InMemoryStateAdapter
wtb_storage: inmemory             # InMemoryUnitOfWork
# æ— éœ€æ•°æ®åº“é…ç½®

# å¼€å‘é…ç½® (æŒä¹…åŒ–çŠ¶æ€ï¼Œå†…å­˜ WTB)
mode: development
state_adapter: agentgit           # AgentGitStateAdapter
agentgit_db: ./data/agentgit.db
wtb_storage: inmemory             # InMemoryUnitOfWork (å¿«é€Ÿé‡å¯)

# æ ‡å‡†é…ç½® (å®Œæ•´æŒä¹…åŒ–)
mode: standalone
state_adapter: agentgit           # AgentGitStateAdapter
agentgit_db: ./data/agentgit.db
wtb_storage: sqlalchemy           # SQLAlchemyUnitOfWork
wtb_db: sqlite:///data/wtb.db

# ç”Ÿäº§é…ç½® (å®Œæ•´é›†æˆ)
mode: full_integration
state_adapter: agentgit           # AgentGitStateAdapter
agentgit_db: ./data/agentgit.db
wtb_storage: sqlalchemy           # SQLAlchemyUnitOfWork
wtb_db: postgresql://user:pass@localhost/wtb
file_tracking: true
file_tracker_storage: ./storage
ide_sync: true
ide_url: http://localhost:8000
```

### å­˜å‚¨æŠ½è±¡ç»„ä»¶

| ç»„ä»¶ | æ¥å£ | å†…å­˜å®ç° | æ•°æ®åº“å®ç° |
|------|------|----------|------------|
| çŠ¶æ€é€‚é…å™¨ | `IStateAdapter` | `InMemoryStateAdapter` | `AgentGitStateAdapter` |
| å·¥ä½œå•å…ƒ | `IUnitOfWork` | `InMemoryUnitOfWork` | `SQLAlchemyUnitOfWork` |
| ä»“å‚¨ | `IRepository<T>` | `InMemory*Repository` | `*Repository` (SQLAlchemy) |

---

---

## 7. Data Characteristics & Storage Strategy (2025-01)

### 7.1 Data Lifecycle Classification

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    WTB DATA LIFECYCLE TAXONOMY                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                    â”‚
â”‚  EPHEMERAL DATA (Request-scoped)                                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                 â”‚
â”‚  â”‚ Data Type          â”‚ Lifetime        â”‚ Storage         â”‚ Access Pattern      â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ Workflow Config    â”‚ Single request  â”‚ Ray ObjectRef   â”‚ Read-once           â”‚ â”‚
â”‚  â”‚ Initial State      â”‚ Single request  â”‚ Ray ObjectRef   â”‚ Read-once           â”‚ â”‚
â”‚  â”‚ Comparison Matrix  â”‚ Response only   â”‚ Memory/ObjectRefâ”‚ Computed, read-once â”‚ â”‚
â”‚  â”‚ Intermediate State â”‚ Node execution  â”‚ Stack/Heap      â”‚ R/W within node     â”‚ â”‚
â”‚                                                                                    â”‚
â”‚  SESSION DATA (Execution-scoped)                                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                â”‚
â”‚  â”‚ Data Type          â”‚ Lifetime        â”‚ Storage         â”‚ Access Pattern      â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ Execution State    â”‚ Workflow run    â”‚ Checkpoint JSON â”‚ Snapshot/Restore    â”‚ â”‚
â”‚  â”‚ Node Boundaries    â”‚ Workflow run    â”‚ WTB DB          â”‚ Append-only         â”‚ â”‚
â”‚  â”‚ Tool Invocations   â”‚ Workflow run    â”‚ AgentGit DB     â”‚ Append-only         â”‚ â”‚
â”‚  â”‚ Audit Events       â”‚ Session         â”‚ WTB DB          â”‚ Append-only         â”‚ â”‚
â”‚                                                                                    â”‚
â”‚  PERSISTENT DATA (System-scoped)                                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                  â”‚
â”‚  â”‚ Data Type          â”‚ Lifetime        â”‚ Storage         â”‚ Access Pattern      â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ Workflow Defs      â”‚ Indefinite      â”‚ PostgreSQL      â”‚ Read-heavy, CRUD    â”‚ â”‚
â”‚  â”‚ Checkpoints        â”‚ Configurable    â”‚ AgentGit DB     â”‚ Append, read for    â”‚ â”‚
â”‚  â”‚                    â”‚ retention       â”‚                 â”‚ rollback            â”‚ â”‚
â”‚  â”‚ Batch Test Results â”‚ Configurable    â”‚ PostgreSQL      â”‚ Append-only, query  â”‚ â”‚
â”‚  â”‚ File Blobs         â”‚ Indefinite      â”‚ FileTracker     â”‚ Write-once, read    â”‚ â”‚
â”‚                                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 Storage Technology Mapping

| Data Category | Technology | Rationale |
|---------------|------------|-----------|
| **Ephemeral/Request** | Ray Object Store (Plasma) | Zero-copy sharing, automatic cleanup, distributed |
| **Session State** | PostgreSQL + JSONB | ACID transactions, flexible schema for checkpoints |
| **Persistent/Structured** | PostgreSQL (Row-based) | Strong consistency, relational queries |
| **Time-Series/Audit** | PostgreSQL + BRIN or TimescaleDB | Efficient time-range queries, partitioning |
| **File Content** | FileTracker (Content-addressed) | Deduplication, immutable blobs |

### 7.3 Indexing Strategy Summary

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    INDEXING DECISION MATRIX                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                    â”‚
â”‚  INDEX TYPE â”‚ USE WHEN                              â”‚ EXAMPLE COLUMNS              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  B-Tree     â”‚ Point lookups, range scans, ORDER BY  â”‚ id, workflow_id, status      â”‚
â”‚  GIN        â”‚ JSONB contains/exists queries         â”‚ metrics, config              â”‚
â”‚  BRIN       â”‚ Physically ordered data (time-series) â”‚ created_at (append-only)     â”‚
â”‚  Hash       â”‚ Equality-only lookups (rarely used)   â”‚ N/A (B-Tree preferred)       â”‚
â”‚                                                                                    â”‚
â”‚  KEY INDEXES:                                                                      â”‚
â”‚  â€¢ wtb_executions(workflow_id, status) - Common filter pattern                    â”‚
â”‚  â€¢ checkpoints(internal_session_id, id) - Rollback chain traversal                â”‚
â”‚  â€¢ wtb_batch_test_results(batch_test_id) - Aggregate results                      â”‚
â”‚  â€¢ audit_events(created_at) BRIN - Time-range queries                             â”‚
â”‚                                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.4 Transaction Boundaries

| Operation | Boundary | Consistency |
|-----------|----------|-------------|
| Create Execution | Single DB transaction | Strong |
| Node Checkpoint | Outbox pattern (WTB â†’ AgentGit) | Eventual |
| Batch Test Aggregate | Collect from ObjectRefs | Eventual |
| Rollback | Single session transaction | Strong |
| File Commit | FileTracker transaction | Strong |

---

## 8. Ray-Based Batch Test Execution (2025-01)

### 8.1 Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    RAY BATCH TEST EXECUTION FLOW                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                    â”‚
â”‚  User Request                                                                      â”‚
â”‚      â”‚                                                                             â”‚
â”‚      â–¼                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  RayBatchTestRunner (Orchestrator)                                            â”‚ â”‚
â”‚  â”‚                                                                               â”‚ â”‚
â”‚  â”‚  1. Put workflow + initial_state â†’ Ray Object Store                          â”‚ â”‚
â”‚  â”‚  2. Create Actor Pool (database connection reuse)                            â”‚ â”‚
â”‚  â”‚  3. Submit variants with backpressure control                                â”‚ â”‚
â”‚  â”‚  4. Collect results via ray.wait()                                           â”‚ â”‚
â”‚  â”‚  5. Build comparison matrix                                                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                      â”‚                                             â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚          â–¼                           â–¼                           â–¼                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Worker Node 1    â”‚      â”‚  Worker Node 2    â”‚      â”‚  Worker Node N    â”‚     â”‚
â”‚  â”‚                   â”‚      â”‚                   â”‚      â”‚                   â”‚     â”‚
â”‚  â”‚  @ray.remote(     â”‚      â”‚  @ray.remote(     â”‚      â”‚  @ray.remote(     â”‚     â”‚
â”‚  â”‚    num_cpus=1,    â”‚      â”‚    num_cpus=1,    â”‚      â”‚    num_cpus=1,    â”‚     â”‚
â”‚  â”‚    memory=2GB)    â”‚      â”‚    memory=2GB)    â”‚      â”‚    memory=2GB)    â”‚     â”‚
â”‚  â”‚                   â”‚      â”‚                   â”‚      â”‚                   â”‚     â”‚
â”‚  â”‚  â€¢ Apply variant  â”‚      â”‚  â€¢ Apply variant  â”‚      â”‚  â€¢ Apply variant  â”‚     â”‚
â”‚  â”‚  â€¢ Run workflow   â”‚      â”‚  â€¢ Run workflow   â”‚      â”‚  â€¢ Run workflow   â”‚     â”‚
â”‚  â”‚  â€¢ Save results   â”‚      â”‚  â€¢ Save results   â”‚      â”‚  â€¢ Save results   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚          â”‚                           â”‚                           â”‚                â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                      â–¼                                             â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚                          â”‚  PostgreSQL (WTB DB)  â”‚                                â”‚
â”‚                          â”‚  â€¢ batch_tests        â”‚                                â”‚
â”‚                          â”‚  â€¢ batch_test_results â”‚                                â”‚
â”‚                          â”‚  â€¢ executions         â”‚                                â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 Key Design Decisions

| Decision | Choice | Rationale |
|----------|--------|-----------|
| **Execution Framework** | Ray | Distributed parallelism, resource management, fault tolerance |
| **Parallelism Unit** | Ray Actor | Database connection reuse, better than Tasks for stateful ops |
| **State Sharing** | ObjectRef (immutable) | Zero-copy, no race conditions |
| **Backpressure** | ray.wait() with limit | Prevents memory exhaustion |
| **Failure Handling** | max_retries + dead-letter | Automatic retry, explicit failure tracking |

### 8.3 Environment Management Integration

**Decision**: Adapt existing environment service via interface abstraction.

```
IEnvironmentProvider
â”œâ”€â”€ InProcessProvider     (testing - no isolation)
â”œâ”€â”€ RayEnvironmentProvider (production - Ray runtime_env)
â””â”€â”€ GrpcEnvironmentProvider (optional - wraps existing service)
```

**Recommendation**: Use `RayEnvironmentProvider` by default. The existing gRPC environment manager can be integrated via `GrpcEnvironmentProvider` if container-level isolation is required.

### 8.4 Configuration Modes

```yaml
# Development (local Ray)
ray_enabled: true
ray_address: null  # Local mode
max_actors: 4

# Production (Ray cluster)
ray_enabled: true
ray_address: "ray://cluster-head:10001"
max_actors: 50
task_timeout: 7200
```

### 8.5 ThreadPoolâ†’Ray Migration (2026-01-15)

**ParityChecker** validates that ThreadPool and Ray runners produce equivalent results before switching production traffic.

```python
from wtb.application.services.parity_checker import ParityChecker, ParityCheckerConfig
from wtb.application.factories import BatchTestRunnerFactory

# Create runners
threadpool_runner = BatchTestRunnerFactory.create_threadpool(config)
ray_runner = BatchTestRunnerFactory.create_ray(config)

# Create parity checker with tolerance
checker = ParityChecker(
    threadpool_runner=threadpool_runner,
    ray_runner=ray_runner,
    config=ParityCheckerConfig(metric_tolerance=0.01),  # 1% tolerance
)

# Dry-run comparison
result = checker.check_parity(batch_test)

if result.is_equivalent:
    print(f"âœ… Parity confirmed! Speedup: {result.speedup_factor:.2f}x")
else:
    print(f"âŒ Discrepancies found: {result.discrepancy_count}")
    for d in result.discrepancies:
        print(f"  - {d.variant_name}: {d.description}")
```

| Feature | Description |
|---------|-------------|
| **Dry-run mode** | Clones batch test to avoid modifying original |
| **Configurable tolerance** | Default 1% relative tolerance for metrics |
| **Timing ignored** | Timing metrics excluded by default |
| **Statistical comparison** | Multiple runs for consistency validation |
| **Discrepancy tracking** | Categorized issues with details |

---

## 9. External API & Observability (2026-01-15)

### 9.1 Multi-Protocol API Architecture

> **å…³é”®å†³ç­–**: ä¸‰ç§åè®®**åŒæ—¶è¿è¡Œ**ï¼Œå®¢æˆ·ç«¯æ ¹æ®éœ€æ±‚é€‰æ‹©åˆé€‚çš„åè®®ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MULTI-PROTOCOL ARCHITECTURE (åŒæ—¶è¿è¡Œ!)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                  â”‚
â”‚  Port 8000 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  â”‚                                                                              â”‚
â”‚  â”œâ”€â”€ /api/v1/*     â†’ REST (FastAPI)     â†’ CRUD, æ§åˆ¶æ“ä½œ, è°ƒè¯•                  â”‚
â”‚  â””â”€â”€ /ws           â†’ WebSocket          â†’ å®æ—¶æ¨é€, äº¤äº’è°ƒè¯•                     â”‚
â”‚                                                                                  â”‚
â”‚  Port 50051 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  â”‚                                                                              â”‚
â”‚  â””â”€â”€ WTBService    â†’ gRPC               â†’ é«˜é¢‘é€šä¿¡, æµå¼æ•°æ®, Ray workers       â”‚
â”‚                                                                                  â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚
â”‚                                                                                  â”‚
â”‚  Web UI å…¸å‹æ¨¡å¼ (REST + WebSocket æ··åˆ):                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  1. REST: åŠ è½½æ•°æ® â†’ GET /api/v1/executions                                â”‚ â”‚
â”‚  â”‚  2. REST: å‘èµ·æ“ä½œ â†’ POST /api/v1/executions/{id}/pause                    â”‚ â”‚
â”‚  â”‚  3. WebSocket: è®¢é˜…æ›´æ–° â†’ subscribe("execution:{id}")                      â”‚ â”‚
â”‚  â”‚  4. WebSocket: æ”¶åˆ°æ¨é€ â†’ NodeCompleted, StateChanged                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| æ“ä½œç±»å‹ | æ¨èåè®® | åŸå›  |
|----------|----------|------|
| Workflow/Execution CRUD | REST | ä½é¢‘, æ˜“è°ƒè¯• |
| Pause/Resume/Stop | REST | æ§åˆ¶æ“ä½œ |
| Execute Single Node | REST | ä¸€æ¬¡æ€§æ“ä½œ |
| **Stream Execution Progress** | WebSocket (UI) / gRPC (æœåŠ¡) | å®æ—¶æ¨é€ |
| **Stream Audit Events** | WebSocket (UI) / gRPC (æœåŠ¡) | å®æ—¶æ¨é€ |
| **Ray Worker Communication** | gRPC | é«˜æ€§èƒ½éœ€æ±‚ |
| **Interactive Debug** | WebSocket | åŒå‘äº¤äº’ |

### 9.2 Fine-Grained Control API Endpoints

**Workflow & Node Level Control:**
```yaml
# Workflow Definition
PUT  /api/v1/workflows/{id}/nodes/{node_id}     â†’ Update node (hot-swap)
POST /api/v1/workflows/{id}/batch-test          â†’ Workflow-level batch test

# Execution Lifecycle
POST /api/v1/executions/{id}/pause              â†’ Pause at current/specified node
POST /api/v1/executions/{id}/resume             â†’ Resume with modified state
POST /api/v1/executions/{id}/stop               â†’ Stop execution

# Node-Level Control (within execution)
POST /api/v1/executions/{id}/nodes/{node_id}/execute    â†’ Execute single node
POST /api/v1/executions/{id}/nodes/{node_id}/skip       â†’ Skip node
POST /api/v1/executions/{id}/nodes/{node_id}/retry      â†’ Retry failed node
POST /api/v1/executions/{id}/nodes/{node_id}/batch-test â†’ Node-level batch test

# Branching & Rollback
POST /api/v1/executions/{id}/branches           â†’ Create branch from checkpoint
POST /api/v1/executions/{id}/branches/{id}/switch â†’ Switch to branch
POST /api/v1/executions/{id}/rollback           â†’ Rollback to checkpoint

# State Modification (Human-in-the-loop)
PATCH /api/v1/executions/{id}/state             â†’ Modify execution state
```

**gRPC Streaming (é«˜é¢‘/å®æ—¶):**
```protobuf
service WTBService {
    rpc StreamExecutionEvents(req) returns (stream ExecutionEvent);
    rpc StreamAuditEvents(req) returns (stream AuditEvent);
    rpc RunBatchTest(req) returns (stream BatchTestProgress);
    rpc InteractiveSession(stream cmd) returns (stream resp);  // åŒå‘
}
```

| æ“ä½œ | å±‚çº§ | Endpoint |
|------|------|----------|
| **Update Node** | Workflow | `PUT /workflows/{id}/nodes/{node_id}` |
| **Execute Single Node** | Execution | `POST /executions/{id}/nodes/{node_id}/execute` |
| **Skip Node** | Execution | `POST /executions/{id}/nodes/{node_id}/skip` |
| **Create Branch** | Execution | `POST /executions/{id}/branches` |
| **Workflow Batch Test** | Workflow | `POST /workflows/{id}/batch-test` |
| **Node Batch Test** | Execution | `POST /executions/{id}/nodes/{node_id}/batch-test` |

### 9.3 Observability Stack (NOT äºŒé€‰ä¸€, æ˜¯ç»„åˆ!)

> **å…³é”®æ¾„æ¸…**: OpenTelemetry / Prometheus / Grafana ä¸æ˜¯æ›¿ä»£å…³ç³»ï¼Œæ˜¯**å®Œæ•´çš„è§‚æµ‹æ ˆ**!

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           OBSERVABILITY STACK è§’è‰²åˆ’åˆ†                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  OpenTelemetry  =  SDK / åŸ‹ç‚¹å·¥å…· (å‚å•†æ— å…³)                                  â”‚â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                 â”‚â”‚
â”‚  â”‚  ä½œç”¨: åœ¨ä»£ç ä¸­åŸ‹ç‚¹, æ”¶é›† traces/metrics/logs                                 â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                    â”‚ å¯¼å‡ºåˆ°                                      â”‚
â”‚                                    â–¼                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  Prometheus     =  Metrics å­˜å‚¨åç«¯ (æ—¶åºæ•°æ®åº“)                              â”‚â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                 â”‚â”‚
â”‚  â”‚  ä½œç”¨: å­˜å‚¨æŒ‡æ ‡æ•°æ®, æ”¯æŒ PromQL æŸ¥è¯¢                                         â”‚â”‚
â”‚  â”‚  WTB å·²æœ‰: MetricsEventListener ç›´æ¥å¯¼å‡º Prometheus æ ¼å¼ âœ…                   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                    â”‚ æŸ¥è¯¢                                        â”‚
â”‚                                    â–¼                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  Grafana        =  å¯è§†åŒ– Dashboard + å‘Šè­¦                                    â”‚â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                     â”‚â”‚
â”‚  â”‚  ä½œç”¨: è¿æ¥ Prometheus/Jaeger/Loki, ç»Ÿä¸€å±•ç¤ºå’Œå‘Šè­¦                            â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                                  â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚
â”‚                                                                                  â”‚
â”‚  æœ€å°å¯è¡Œæ ˆ (å·²æœ‰):     WTB â†’ Prometheus (MetricsEventListener) â†’ Grafana       â”‚
â”‚  å®Œæ•´æ ˆ:               WTB â†’ OpenTelemetry â†’ Prometheus + Jaeger + Loki â†’ Grafanaâ”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| å±‚çº§ | æŠ€æœ¯é€‰æ‹© | ä½œç”¨ |
|------|----------|------|
| **åŸ‹ç‚¹å±‚** | OpenTelemetry SDK | å‚å•†æ— å…³çš„åŸ‹ç‚¹æŠ½è±¡ |
| **Metrics åç«¯** | **Prometheus** | æ—¶åºæ•°æ®å­˜å‚¨ (å·²æœ‰é›†æˆ) |
| **Traces åç«¯** | Jaeger (å¯é€‰) | åˆ†å¸ƒå¼è¿½è¸ª |
| **å¯è§†åŒ–** | **Grafana** | Dashboard + å‘Šè­¦ |

**Key Metrics Exported:**

| Metric | Type | Purpose |
|--------|------|---------|
| `wtb_executions_total` | Counter | Executions by status (completed/failed) |
| `wtb_execution_duration_seconds` | Histogram | Latency distribution |
| `wtb_node_duration_seconds` | Histogram | Per-node execution time |
| `wtb_checkpoints_total` | Counter | Checkpoint creation rate |
| `wtb_rollbacks_total` | Counter | Rollback frequency |
| `wtb_audit_events_total` | Counter | Audit events by type |
| `wtb_ray_workers_active` | Gauge | Ray worker utilization |

### 9.4 Audit Event Exposure

| Consumer | Method | Use Case |
|----------|--------|----------|
| Web UI | WebSocket subscription | Live timeline, progress |
| External Services | gRPC `StreamAuditEvents()` | Real-time integration |
| Analytics | REST `/api/v1/audit/events` | Historical queries |
| Monitoring | Prometheus metrics | Aggregated rates, alerts |
| Dashboards | Grafana | Visualization |

### 9.5 Transaction Consistency (ACID)

| Operation | Transaction Boundary | Consistency |
|-----------|---------------------|-------------|
| Create Execution | Single DB transaction | Strong |
| Create Checkpoint | DB + Outbox pattern | Strong |
| Rollback | Multi-step Saga | Eventual |
| Batch Test Results | Ray ObjectRef aggregation | Eventual |
| Audit Event Recording | Batch flush (5s interval) | Eventually consistent |

**Outbox Pattern for Event Delivery:**

Events are stored in `wtb_outbox` table within the same transaction as business operations, ensuring no events are lost even if the event bus is temporarily unavailable.

---

## Related Documentation

| Document | Content |
| -------- | ------- |
| `WORKFLOW_TEST_BENCH_ARCHITECTURE.md` | Complete architecture, Ray BatchTestRunner, domain models, Â§13 Critical Decisions |
| `DATABASE_DESIGN.md` | Three-database architecture, indexing strategy, storage decisions |
| `PROGRESS_TRACKER.md` | Implementation status tracking |
| [external_api/](../external_api/) | **NEW** External API & Observability Design |
| [EventBus_and_Audit_Session/](../EventBus_and_Audit_Session/) | Event Bus & Audit Trail design |
| [Adapter_and_WTB-Storage/](../Adapter_and_WTB-Storage/) | State Adapter & Storage design |
| [Ray/](../Ray/) | Ray BatchTestRunner implementation |
| [LangGraph/](../LangGraph/) | LangGraph integration design |
